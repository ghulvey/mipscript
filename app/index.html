<!DOCTYPE html>
<html>
    <head>
        <title>MipScript Editor</title>
        <link rel="stylesheet" href="styles.css">
        <script src="../node_modules/monaco-editor/min/vs/loader.js"></script>
        <script>

            require.config({ paths: { vs: './node_modules/monaco-editor/min/vs' } });

            require(['vs/editor/editor.main'], function () {

                // Register a new language
                monaco.languages.register({ id: "mipScriptLang" });

                // Register a tokens provider for the language
                monaco.languages.setMonarchTokensProvider("mipScriptLang", {
                    tokenizer: {
                        root: [
                            [/int/, "type"],
                            [/true|false/, "boolean"],
                            [/if|else/, "conditional"],
                            [/while|for/, "loop"],
                            [/=/, "assignment"],
                            [/==|!=|<=|>=|<|>/, "comparison"],
                            [/[0-9]+/, "number"],
                            [/[a-zA-Z_][a-zA-Z0-9_]*/, "variable"],
                            [/print/, "method"],
                            [/;/, "delimiter"],
                            [/[ \t\r\n]+/, "white"],
                            [/#(.*)/, "comment"],
                        ],
                    },
                });

                // Define a new theme that contains only rules that match this language
                monaco.editor.defineTheme("mipScriptLangTheme", {
                    base: "vs-dark",
                    inherit: false,
                    rules: [
                        { token: "data-type", foreground: "2228a8" },
                    ],
                    colors: {
                        "editor.foreground": "#ffffff",
                    },
                });

                // Register a completion item provider for the new language
                monaco.languages.registerCompletionItemProvider("mipScriptLang", {
                    provideCompletionItems: (model, position) => {
                        var word = model.getWordUntilPosition(position);
                        var range = {
                            startLineNumber: position.lineNumber,
                            endLineNumber: position.lineNumber,
                            startColumn: word.startColumn,
                            endColumn: word.endColumn,
                        };
                        var suggestions = [
                            {
                                label: "simpleText",
                                kind: monaco.languages.CompletionItemKind.Text,
                                insertText: "simpleText",
                                range: range,
                            },
                            {
                                label: "testing",
                                kind: monaco.languages.CompletionItemKind.Keyword,
                                insertText: "testing(${1:condition})",
                                insertTextRules:
                                    monaco.languages.CompletionItemInsertTextRule
                                        .InsertAsSnippet,
                                range: range,
                            },
                            {
                                label: "ifelse",
                                kind: monaco.languages.CompletionItemKind.Snippet,
                                insertText: [
                                    "if (${1:condition}) {",
                                    "\t$0",
                                    "} else {",
                                    "\t",
                                    "}",
                                ].join("\n"),
                                insertTextRules:
                                    monaco.languages.CompletionItemInsertTextRule
                                        .InsertAsSnippet,
                                documentation: "If-Else Statement",
                                range: range,
                            },
                        ];
                        return { suggestions: suggestions };
                    },
                });

                window.mipscriptEditor = monaco.editor.create(document.getElementById('mipscript'), {
                    value: ['int x = 0;\nprint(x);'].join('\n'),
                    theme: "mipScriptLangTheme",
                    language: "mipScriptLang",
                    automaticLayout: true,
                    readOnly: false,
                    scrollbar: {
                        // Subtle shadows to the left & top. Defaults to true.
                        useShadows: false,

                        // Render vertical arrows. Defaults to false.
                        verticalHasArrows: true,
                        // Render horizontal arrows. Defaults to false.
                        horizontalHasArrows: true,

                        // Render vertical scrollbar.
                        // Accepted values: 'auto', 'visible', 'hidden'.
                        // Defaults to 'auto'
                        vertical: "visible",
                        // Render horizontal scrollbar.
                        // Accepted values: 'auto', 'visible', 'hidden'.
                        // Defaults to 'auto'
                        horizontal: "visible",

                        verticalScrollbarSize: 17,
                        horizontalScrollbarSize: 17,
                        arrowSize: 30,
                    },
                });

                window.asmEditor = monaco.editor.create(document.getElementById('assembly'), {
                    language: 'assembly',
                    automaticLayout: true,
                    readOnly: true,
	theme: "vs-dark",
                    scrollbar: {
                        // Subtle shadows to the left & top. Defaults to true.
                        useShadows: false,

                        // Render vertical arrows. Defaults to false.
                        verticalHasArrows: true,
                        // Render horizontal arrows. Defaults to false.
                        horizontalHasArrows: true,

                        // Render vertical scrollbar.
                        // Accepted values: 'auto', 'visible', 'hidden'.
                        // Defaults to 'auto'
                        vertical: "visible",
                        // Render horizontal scrollbar.
                        // Accepted values: 'auto', 'visible', 'hidden'.
                        // Defaults to 'auto'
                        horizontal: "visible",

                        verticalScrollbarSize: 17,
                        horizontalScrollbarSize: 17,
                        arrowSize: 30,
                    },
                });

                
            });

            function runCode() {
                let code = mipscriptEditor.getValue();
                let asm = Module.evalCode(code);
                window.asmEditor.setValue(asm);
            }


            
        </script>
        <script src="./mipscript.js"></script>
    </head>
    <body>
        <header>
            <h1>MipScript Editor</h1>
            <p>By: Gavin Hulvey</p>
        </header>
        <main>
        <div class="editor">
            <div class="toolbar">
                <h2>MipScript</h2>
                <div class="buttons">
                <button id="run" onclick="runCode()">Run</button>
                <button id="save">Save</button>
                <button id="load">Load</button>
            </div>
            </div>
            <div id="mipscript"></div>
        </div>
        <div class="editor">
            <div class="toolbar">
                <h2>Assembly</h2>
                <div class="buttons">
                <button id="save">Save</button>
            </div>
            </div>
            <div id="assembly"></div>
        </div> 
    </main>
    </body>
</html>
